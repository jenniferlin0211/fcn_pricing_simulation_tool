<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>MC Pro Cloud Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        .header { background: #1a237e; color: white; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; }
        .input-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .kpi-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; text-align: center; flex: 1; border-top: 6px solid #1a237e; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        button { background: #1a237e; color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 15px; }
        button:hover { background: #283593; }
        .chart-area { display: flex; gap: 20px; }
        .main-card { background: white; padding: 20px; border-radius: 12px; flex: 1; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .tsla-orange { color: #FF9800; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>結構型商品即時模擬器 (Cloud版)</h1></div>

    <div class="input-card">
        <h3>模擬參數設定</h3>
        <div class="grid-inputs">
            <div><label>標的名稱</label><input type="text" id="assetName" value="TSLA" style="width:90%"></div>
            <div><label>波動率 (%)</label><input type="number" id="vol" value="35" style="width:90%"></div>
            <div><label>模擬次數</label><input type="number" id="nSims" value="10000" style="width:90%"></div>
        </div>
        <button onclick="runSimulation()">立即開始執行模擬 (Run Simulation)</button>
    </div>

    <div class="kpi-row">
        <div class="kpi-card"><div>Fair Value</div><span id="fvResult" style="font-size:36px; font-weight:bold; color:#1a237e">--</span>%</div>
        <div class="kpi-card"><div>接股機率</div><span id="kiResult" style="font-size:36px; font-weight:bold; color:#FF9800">--</span>%</div>
    </div>

    <div class="chart-area">
        <div class="main-card">
            <h3>說明</h3>
            <p>這是一個純客戶端運算的模擬器。當你按下按鈕時，瀏覽器會使用 JavaScript 進行 Monte Carlo 運算。</p>
            <p>當前分析標的：<span id="displayAsset" class="tsla-orange">TSLA</span></p>
        </div>
    </div>
</div>

<script>
    function runSimulation() {
        // 1. 抓取參數
        const asset = document.getElementById('assetName').value;
        const vol = parseFloat(document.getElementById('vol').value) / 100;
        const nSims = parseInt(document.getElementById('nSims').value);
        
        document.getElementById('displayAsset').innerText = asset;
        if (asset.toUpperCase() === "TSLA") {
            document.getElementById('displayAsset').className = "tsla-orange";
        } else {
            document.getElementById('displayAsset').className = "";
        }

        // 2. 核心模擬引擎 (簡化版 Monte Carlo)
        let totalPayoff = 0;
        let kiCount = 0;

        for (let i = 0; i < nSims; i++) {
            // 生成標準常態隨機數 (Box-Muller)
            let u = 1 - Math.random();
            let v = 1 - Math.random();
            let z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            
            // 假設一年期 Fair Value 計算 (簡化示意)
            let price = 100 * Math.exp((-0.5 * vol * vol) + vol * z);
            
            let payoff = 0;
            if (price >= 100) {
                payoff = 105; // 獲利
            } else if (price < 75) {
                payoff = price; // 接股
                kiCount++;
            } else {
                payoff = 100; // 安全到期
            }
            totalPayoff += payoff;
        }

        // 3. 更新介面
        const avgFV = totalPayoff / nSims;
        const kiProb = (kiCount / nSims) * 100;

        document.getElementById('fvResult').innerText = avgFV.toFixed(2);
        document.getElementById('kiResult').innerText = kiProb.toFixed(1);
    }
</script>

</body>
</html>
